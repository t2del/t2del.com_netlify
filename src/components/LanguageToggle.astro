---
// src/components/LanguageToggle.astro (Corrected for Astro's Native i18n)

// We'll manually import the locales/config structure instead of relying on getI18n()
// The actual locale list must be imported/defined here.
// NOTE: Adjust the path below if your config is elsewhere.
const ALL_LOCALES = ['en', 'es']; 
const DEFAULT_LOCALE = 'en'; 
const PREFIX_DEFAULT = Astro.generator.includes('PrefixDefaultLocale:true'); // A simple way to check config if not manually imported

import { stripLocaleFromPathname } from '../i18n/utils';

// Get current locale from Astro's global context
const currentLocale = Astro.currentLocale || DEFAULT_LOCALE;

// Assemble a basic config object to pass to the utility function
const localeConfig = {
    currentLocale: currentLocale,
    defaultLocale: DEFAULT_LOCALE,
    prefixDefaultLocale: PREFIX_DEFAULT // Should match your astro.config.mjs setting
};

// Get the path without the current locale prefix
const basePath = stripLocaleFromPathname(Astro.url.pathname, localeConfig);

// Define display names for locales
const localeLabels: Record<string, string> = {
    'en': 'EN',
    'es': 'ES',
};

/**
 * Function to construct the new URL for a given locale.
 */
function getNewLocalePath(locale: string): string {
  // If the new locale is the default AND we don't prefix the default, use the base path directly.
  if (locale === DEFAULT_LOCALE && !PREFIX_DEFAULT) {
    return basePath;
  }
  
  // Otherwise, prefix the path with the locale.
  return `/${locale}${basePath}`;
}
---

<nav aria-label="Language Selector">
  <ul style={{ display: 'flex', gap: '10px', listStyle: 'none', padding: '0' }}>
    {ALL_LOCALES.map((locale) => (
      <li>
        <a 
          href={getNewLocalePath(locale)}
          class:list={[
            locale === currentLocale ? 'active-lang' : ''
          ]}
          aria-current={locale === currentLocale ? 'true' : 'false'}
          hreflang={locale} 
        >
          {localeLabels[locale] || locale.toUpperCase()}
        </a>
      </li>
    ))}
  </ul>
</nav>

<style>
  .active-lang {
    font-weight: bold;
    text-decoration: none;
    pointer-events: none;
    color: var(--color-primary, blue);
  }
</style>